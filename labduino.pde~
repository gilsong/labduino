/*

 Labduino 

 Author: Gilson Giuriatti 

 Contact: gilson@gmail.com

 Created: 2010

 Modified: Maio 2011
 
 */


char buff[64]; //maximo 128
char *bufflast;
char *buffword;
char *tempbuff;


void setup()
{
  Serial.begin(115200);
}


void loop()
{
  if ( readstring() ) option();
}


void option()
{
    switch(readstr())
    {
    case 'adc':
      adc();
      break;
    default:
      err();
    }
}


void ok() 
{
   Serial.println("_ok_");
}


void err()
{
   Serial.println("_err_");
}


boolean readstring()
{
    if( Serial.available() )
    {
       int index = 0;
       delay(1);
       while ( Serial.available() )
       {
          buff[index] = Serial.read();
          index++;
       }
       tempbuff = buff;
    }
}



char separa()
{
  buffword = strtok_r(tempbuff," ",&bufflast);
  tempbuff= NULL;
  if (buffword != NULL) return 1;
  return 0;
}



char readstr()
{
  if ( separa() ) return char(buffword);
  return 0;
}

float readfloat()
{
  if ( separa() ) return atof(buffword);
  return 0;
}

int readint()
{
  if (separa()) return atoi(buffword);
  return 0;
}

char readchar()
{
  if (separa()) return buffword[0];
  return 0;
}

float adc()
{
  return analogRead( readint() )*5.0/1023;
}

